# Technical Context: Trade360 Java SDK

## Technology Stack

### Core Technologies

#### Java 17 (LTS)
- **Version**: 17 (minimum required)
- **Why**: Long-term support, modern language features (records, pattern matching, sealed classes)
- **Constraint**: Must maintain Java 17 compatibility (no Java 21+ features)
- **Note**: Java 24 compatibility issues exist with Mockito's Byte Buddy (cannot mock certain classes)

#### Maven 3.9.8+
- **Purpose**: Build automation and dependency management
- **Configuration**: Multi-module project with parent POM
- **Modules**:
  - `trade360-java` (parent)
  - `sdk/trade360-java-sdk` (core library)
  - `samples/trade360-samples` (example applications)

### Framework Stack

#### Spring Boot 3.3.2
- **Parent**: `spring-boot-starter-parent:3.3.2`
- **Starters Used**:
  - `spring-boot-starter-amqp` - RabbitMQ integration
  - `spring-boot-starter-webflux` - Reactive HTTP client
  - `spring-boot-starter-validation` - Bean validation
  - `spring-boot-starter-test` - Testing utilities
- **Why Spring Boot**: Industry standard, excellent ecosystem, auto-configuration

#### Spring AMQP
- **Version**: Managed by Spring Boot (3.1.x)
- **Purpose**: RabbitMQ client and listener containers
- **Key Components**:
  - `CachingConnectionFactory` - Connection pooling
  - `SimpleRabbitListenerContainerFactory` - Message listener containers
  - `RabbitTemplate` - Message sending (not used in SDK, but available)
  - Retry interceptors with exponential backoff

#### Spring WebFlux
- **Version**: Managed by Spring Boot
- **Purpose**: Non-blocking HTTP client
- **Key Components**:
  - `WebClient` - Reactive HTTP client
  - Netty as underlying HTTP implementation
  - Supports connection pooling, timeouts, error handling

#### Project Reactor
- **Version**: Managed by Spring Boot (3.6.x)
- **Purpose**: Reactive streams implementation
- **Key Types**:
  - `Mono<T>` - Async single value or error
  - `Flux<T>` - Async sequence (not used in SDK but available)
- **Why Reactive**: Non-blocking I/O, better resource utilization, high throughput

### Data & Serialization

#### Jackson 2.15.x
- **Modules**:
  - `jackson-databind` - Core serialization
  - `jackson-annotations` - Annotations for mapping
  - `jackson-datatype-jsr310` - Java 8 time support (LocalDateTime, etc.)
- **Configuration**:
  - `PropertyNamingStrategies.UPPER_CAMEL_CASE` - LSports API format
  - `DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES=false` - Forward compatibility
  - Custom serializers for special types (e.g., `LSportsLocalDateTimeSerializer`)

#### Lombok 1.18.x
- **Purpose**: Reduce boilerplate code
- **Usage**:
  - `@Data` - Getters, setters, toString, equals, hashCode
  - `@Builder` - Builder pattern
  - `@Slf4j` - Logger injection
  - `val` - Local variable type inference (note: caused issues, replaced with explicit types in some places)
- **Constraint**: Optional dependency, must not be required in generated bytecode

### Testing Stack

#### JUnit 4.13.2
- **Why JUnit 4**: Project started with JUnit 4, migration to JUnit 5 not yet done
- **Annotations**: `@Test`, `@Before`, `@After`, `@RunWith`
- **Assertions**: `assertEquals`, `assertNotNull`, `assertTrue`, etc.

#### Mockito (via Spring Boot Test)
- **Version**: Managed by Spring Boot
- **Purpose**: Mock dependencies in unit tests
- **Important Note**: Java 24 has compatibility issues with Mockito's Byte Buddy
  - Cannot mock final classes (records)
  - Cannot mock Spring components in some cases
  - Workaround: Use real instances instead of mocks

#### OkHttp MockWebServer 5.0.0-alpha.14
- **Purpose**: Mock HTTP servers for integration tests
- **Usage**: Test HTTP clients without real network calls
- **Example**:
  ```java
  MockWebServer server = new MockWebServer();
  server.enqueue(new MockResponse().setBody("{...}"));
  String baseUrl = server.url("/").toString();
  ```

#### JaCoCo 0.8.12
- **Purpose**: Code coverage measurement
- **Configuration**: Maven plugin with report generation
- **Target**: 80%+ line and branch coverage
- **Reports**: Generated at `target/site/jacoco/index.html`
- **Important**: Do not modify `pom.xml` test configuration as it affects Codacy reporting

### Build & Quality Tools

#### Maven Plugins

##### Core Plugins
- `maven-compiler-plugin` - Java compilation
- `maven-source-plugin:3.3.0` - Source JAR generation
- `maven-javadoc-plugin:3.6.3` - Javadoc generation
- `spring-boot-maven-plugin` - Spring Boot packaging

##### Quality Plugins
- `jacoco-maven-plugin:0.8.12` - Code coverage
  - `prepare-agent` goal - Instruments bytecode
  - `report` goal - Generates HTML reports
  
##### Release Plugins (used in `release` profile)
- `central-publishing-maven-plugin` - Maven Central publication
- `maven-gpg-plugin:3.1.0` - Artifact signing

#### Codacy
- **Purpose**: Static code analysis and quality gates
- **Integration**: Codacy MCP Server via Cursor IDE
- **Rules**:
  - Must run `codacy_cli_analyze` after any file edit
  - Must run with `tool=trivy` after dependency changes
  - Never modify `pom.xml` without understanding Codacy impact
- **Metrics**: Code coverage, complexity, security vulnerabilities

## Development Setup

### Required Tools

1. **Java Development Kit (JDK) 17**
   - Recommended: [Eclipse Temurin 17](https://adoptium.net/temurin/releases/?version=17)
   - Alternative: [OpenJDK 17](https://jdk.java.net/java-se-ri/17-MR1)
   - Verify: `java -version` should show Java 17

2. **Apache Maven 3.9.8+**
   - Download: [Maven Downloads](https://maven.apache.org/download.cgi)
   - Verify: `mvn -version` should show Maven 3.9.8 or higher

3. **IDE (Recommended)**
   - IntelliJ IDEA (Ultimate or Community)
   - Eclipse with Spring Tools
   - Visual Studio Code with Java extensions
   - **Cursor IDE** (for AI-assisted development)

4. **Git**
   - For version control
   - Configure: `git config --global user.name "Your Name"`

### IDE Configuration

#### IntelliJ IDEA
```xml
<!-- Settings → Build, Execution, Deployment → Build Tools → Maven -->
<maven>
  <jdk>17</jdk>
  <mavenHome>/path/to/maven</mavenHome>
</maven>

<!-- Settings → Build, Execution, Deployment → Compiler → Annotation Processors -->
<annotationProcessing>
  <enabled>true</enabled> <!-- For Lombok -->
</annotationProcessing>
```

#### Lombok Plugin
- IntelliJ: Install "Lombok" plugin from marketplace
- Eclipse: Download `lombok.jar` and run it
- VS Code: Install "Lombok Annotations Support" extension

### Build Commands

```bash
# Full build with tests
mvn clean install

# Build without tests (faster)
mvn clean install -DskipTests

# Run tests only
mvn test

# Generate coverage report
mvn clean test jacoco:report

# Run specific test
mvn test -Dtest=JacksonApiSerializerTests

# Package for distribution
mvn clean package

# Run sample application
cd samples/trade360-samples
mvn spring-boot:run

# Release to Maven Central (requires credentials)
mvn clean deploy -P release
```

### Local Development Workflow

1. **Clone Repository**
   ```bash
   git clone https://github.com/lsportsltd/trade360-java-sdk.git
   cd trade360-java-sdk
   ```

2. **Import into IDE**
   - IntelliJ: File → Open → Select `pom.xml`
   - Eclipse: File → Import → Maven → Existing Maven Projects

3. **Build Project**
   ```bash
   mvn clean install
   ```

4. **Run Tests**
   ```bash
   mvn test
   ```

5. **Configure Application**
   - Copy `samples/trade360-samples/src/main/resources/application.properties.template`
   - Rename to `application.properties`
   - Fill in your credentials

6. **Run Sample Application**
   ```bash
   cd samples/trade360-samples
   mvn spring-boot:run
   ```

## Technical Constraints

### Performance Constraints
- **Message Throughput**: Must handle 1000+ messages/sec without message loss
- **HTTP Latency**: API calls should complete within 5 seconds (configurable timeout)
- **Memory**: JVM heap should not exceed 512MB under normal load (samples)
- **Connection Pooling**: RabbitMQ connection pool limited to 10 connections

### Compatibility Constraints
- **Java Version**: Minimum Java 17, tested up to Java 21
- **Spring Boot**: Must stay on 3.x (Jakarta EE namespace)
- **Jackson**: Must remain compatible with LSports API JSON format
- **Backward Compatibility**: No breaking API changes within major version

### Security Constraints
- **No Hardcoded Secrets**: All credentials from configuration
- **Dependency Scanning**: Trivy scans for vulnerabilities
- **Signed Artifacts**: Maven Central requires GPG signing
- **TLS**: All HTTP connections use HTTPS (except localhost dev)

### Build Constraints
- **Build Time**: Full build (with tests) should complete in < 3 minutes
- **Test Coverage**: Must maintain 80%+ coverage for new code
- **No Test Failures**: All tests must pass before merge
- **Codacy Quality Gate**: Must maintain grade A or B

## Dependencies

### Runtime Dependencies
```xml
<!-- Spring Boot Starters -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-amqp</artifactId>
</dependency>
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-webflux</artifactId>
</dependency>
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-validation</artifactId>
</dependency>

<!-- JSON Processing -->
<dependency>
    <groupId>com.fasterxml.jackson.core</groupId>
    <artifactId>jackson-databind</artifactId>
</dependency>
<dependency>
    <groupId>com.fasterxml.jackson.datatype</groupId>
    <artifactId>jackson-datatype-jsr310</artifactId>
</dependency>

<!-- Utilities -->
<dependency>
    <groupId>org.projectlombok</groupId>
    <artifactId>lombok</artifactId>
    <optional>true</optional>
</dependency>
<dependency>
    <groupId>org.jetbrains</groupId>
    <artifactId>annotations</artifactId>
    <version>17.0.0</version>
</dependency>
```

### Test Dependencies
```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-test</artifactId>
    <scope>test</scope>
</dependency>
<dependency>
    <groupId>org.springframework.amqp</groupId>
    <artifactId>spring-rabbit-test</artifactId>
    <scope>test</scope>
</dependency>
<dependency>
    <groupId>junit</groupId>
    <artifactId>junit</artifactId>
    <version>4.13.2</version>
    <scope>test</scope>
</dependency>
<dependency>
    <groupId>com.squareup.okhttp3</groupId>
    <artifactId>mockwebserver</artifactId>
    <version>5.0.0-alpha.14</version>
    <scope>test</scope>
</dependency>
```

## Infrastructure Requirements

### Development Environment
- **OS**: macOS, Linux, or Windows with WSL2
- **RAM**: Minimum 8GB, recommended 16GB
- **Disk**: 5GB free space for Maven cache and builds
- **Network**: Internet access for Maven dependencies

### RabbitMQ (for Feed Integration)
- **Version**: 3.12+
- **Plugins**: `rabbitmq_management` (optional, for UI)
- **Connection**: AMQP over TCP (port 5672) or TLS (port 5671)
- **Credentials**: Username, password, virtual host

### HTTP APIs
- **Snapshot API**: `https://stm-snapshot.lsports.eu`
- **Customers API**: `https://stm-api.lsports.eu`
- **Authentication**: Basic auth (username/password)
- **Format**: JSON over HTTPS

### CI/CD (GitHub Actions)
- **Java**: Setup JDK 17
- **Maven**: Cache `.m2/repository`
- **Tests**: Run `mvn clean test`
- **Coverage**: Upload to Codacy
- **Artifacts**: Publish to Maven Central on release

## Version History

- **2.4.0** (Current): Latest stable, package namespace migration
- **2.2.0**: Previous stable
- **2.x**: Spring Boot 3.x series
- **1.x**: Spring Boot 2.x series (deprecated)

**Last Updated**: November 2025  
**Owner**: LSports Development Team

